<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:metro="http://metro.mahapps.com/winfx/xaml/controls"
                    xmlns:simpleChildWindow="http://metro.mahapps.com/winfx/xaml/simplechildwindow"
                    xmlns:local="clr-namespace:RayCarrot.RCP.Metro">

    <Style TargetType="{x:Type local:RCPChildWindow}" BasedOn="{StaticResource {x:Type simpleChildWindow:ChildWindow}}">
        <Setter Property="OverlayBrush" Value="#10FFFFFF" />
        <Setter Property="ShowCloseButton" Value="True" />
        <Setter Property="CloseByEscape" Value="True" />
        <Setter Property="AllowMove" Value="True" />
        <Setter Property="Padding" Value="15" />
        <Setter Property="TitleHorizontalAlignment" Value="Stretch" />
        <Setter Property="TitleTemplate">
            <Setter.Value>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Margin="10 0 0 0"
                                   VerticalAlignment="Center"
                                   Text="{Binding}" />

                        <StackPanel Grid.Column="1" 
                                    Orientation="Horizontal"
                                    DataContext="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:RCPChildWindow}}">

                            <Button Height="{Binding Path=TitleBarHeight, Mode=OneWay}"
                                    Visibility="{Binding Path=IsModal, Converter={local:InvertedBooleanToVisibilityConverter}}"
                                    Command="{Binding Path=MinimizeCommand, Mode=OneTime}"
                                    Focusable="False"
                                    IsTabStop="True"
                                    Style="{DynamicResource MahApps.Styles.Button.MetroWindow.Light}">
                                <Path Data="M0,0L10,0 10,1 10,1 1,1 0,1z"
                                      Width="10" Height="10"
                                      VerticalAlignment="Center"
                                      RenderOptions.EdgeMode="Aliased"
                                      Stretch="Uniform"
                                      Fill="{Binding Path=TitleForeground, Mode=OneWay}"
                                      SnapsToDevicePixels="True" />
                            </Button>

                        </StackPanel>

                    </Grid>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="IconTemplate">
            <Setter.Value>
                <DataTemplate>
                    <metro:MultiFrameImage Width="30"
                                           Height="30"
                                           RenderOptions.BitmapScalingMode="NearestNeighbor"
                                           Source="../../Img/RCP_Metro.ico" />
                </DataTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>